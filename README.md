# tag-pp
情報科学実験I超高性能化課題のためのデータ前処理プログラム  

    $ tag-pp <サブコマンド>

## Disclaimer
自分がやったときと`tag.csv`,`geotag.csv`の内容が変わってるかもしれないので、そうなってたらたぶん何もうまくいきません  
自己責任でよろしく  

## サブコマンド一覧  
- tag-pp  
`$ tag-pp tag-pp <tag.csvの場所> <出力先>`  
tagをtag_pp.csv形式に変換  

- geotag-pp  
`$ tag-pp geotag-pp <tag_pp.csvの場所> <geotag.csvの場所> <出力先>`  
geotagをgeotag_pp.csv形式に変換  

- gen-test  
`$ tag-pp gen-test <tag.csv> <geotag.csv> <行数>`  
元ファイルからうまいこと切り出してテスト用の小さなtag_pp.csvとgeotag_pp.csvを作る

## やってること
### tag-pp
`tag.csv` は 各行が `<画像ID>,<タグ>` の構造になっている。  
どうせタグ検索しかしないので、これを `<タグ>,<IDの個数>,<画像ID①>,<画像ID②>, ...` のように変換する  
(IDの個数はなんとなく付けてみたけど、今サーバの実装見たら使ってなかったので、これをなくすともう少し節約できそう)  

ちなみに、`tag.csv`には「IDだけあってタグがない」行が結構ある。  
こういう行は`NO_TAG`というタグを持つものとして出力して、あとで使う。

### geotag-pp
やってることは以下の2つ  
① `NO_TAG`なIDに対応する行を削除(どうせタグ検索に引っ掛からないので)  
② 各行をより空間効率のよい形式に変換する  

②について説明する。  
元の`geotag.csv`の各行は次のような構造になっている。  
`<ID>,"<日付>",<緯度>,<経度>,<URL>`  

節約できそうなところは日付とURLなので、頑張って削る。  
- 日付  
与えられる日付は全部2038年以前なので、32ビット符号付き整数(i32)のタイムスタンプで表現できる。  
日付は19文字なのだが、i32にすれば(日付は正の数であることを考慮すると)最大10文字になる。  
(今思うと16進数にすれば最大8文字になるのでもうちょっと節約できる)  

- URL  
URLは全部以下のような形。  
`http://farm<ドメイン数>.static.flickr.com/<ディレクトリ数>/<画像ID>_<末尾数>.jpg`  
ここで、それぞれの要素は以下のような性質を持つ  
    - ドメイン数: 数字1文字
    - ディレクトリ数: 数字1~4文字
    - 末尾数: 10桁の16進数

共通部分を削って、あと画像IDはすでに出てきてるので削除すると、元の61文字(概算)から、データと区切り文字で合わせて17文字まで減らせる
